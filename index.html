<script type="module">
  // Load the Observable Runtime.
  import { Runtime } from "https://unpkg.com/@observablehq/notebook-runtime?module";
  
  const renderNotebook = notebook => {
    console.log('loaded notebook:', notebook);
  
    // Load the notebook, and render any cells which start with "rendered_".
    document.body.innerHTML = '';
    Runtime.load(notebook, ({ name }) => {
      if (name && (name.startsWith('render_') || name.startsWith('style_'))) {
        return {
          fulfilled: (value) => {
            if (value instanceof HTMLElement) {
              console.log('append element:', name);
              document.body.appendChild(value);
            }
          }
        };
      }
    });
  }
  
  const getUrlParams = () => {
    var params = {};
    window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, (m, key, value) => params[key] = value);
    return params;
  }
  
  const urlParams = getUrlParams();
  const getUrlParam = (name, defaultValue) => urlParams[name] || defaultValue;

  // Import the notebook.
  const url = `https://api.observablehq.com/${getUrlParam('name', '@trebor')}/${getUrlParam('notebook', 'portfolio')}.js`;
  console.log('loading notebook:', url);
  
  import(url).then(module => renderNotebook(module.default));
</script>
